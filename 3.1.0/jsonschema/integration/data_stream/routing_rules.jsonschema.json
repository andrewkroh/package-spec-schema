{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.elastic.dev/package-spec/3.1.0/integration/data_stream/routing_rules.jsonschema.json",
  "description": "Routing rules set.",
  "type": "array",
  "items": {
    "type": "object",
    "required": [
      "source_dataset",
      "rules"
    ],
    "properties": {
      "rules": {
        "description": "List of routing rules",
        "type": "array",
        "items": {
          "$ref": "#/definitions/routing_rule"
        }
      },
      "source_dataset": {
        "description": "Source dataset to be used by this reroute processsor. If applicable, documents from this dataset will be routed according to the rules defined.\n",
        "type": "string"
      }
    },
    "additionalProperties": false
  },
  "definitions": {
    "routing_rule": {
      "description": "Routing rule definition (technical preview)",
      "type": "object",
      "required": [
        "target_dataset",
        "if"
      ],
      "properties": {
        "if": {
          "description": "Conditionally execute the processor",
          "examples": [
            "ctx?.file?.path?.contains('/var/log/nginx/error')",
            "ctx?.container?.image?.name == 'nginx'"
          ],
          "type": "string"
        },
        "namespace": {
          "description": "Field references or a static value for the namespace part of the data stream name. See the criteria for index names for allowed characters. Must be no longer than 100 characters.\nSupports field references with a mustache-like syntax (denoted as {{double}} or {{{triple}}} curly braces). When resolving field references, the processor replaces invalid characters with _. Uses the <namespace> part of the index name as a fallback if all field references resolve to a null, missing, or non-string value.\n",
          "examples": [
            "default",
            "{{ labels.dasta_stream.namespace}}"
          ],
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ],
          "items": {
            "type": "string"
          }
        },
        "target_dataset": {
          "description": "Field references or a static value for the dataset part of the data stream name. In addition to the criteria for index names, cannot contain - and must be no longer than 100 characters. Example values are nginx.access and nginx.error.\nSupports field references with a mustache-like syntax (denoted as {{double}} or {{{triple}}} curly braces). When resolving field references, the processor replaces invalid characters with _. Uses the <dataset> part of the index name as a fallback if all field references resolve to a null, missing, or non-string value\n",
          "examples": [
            "nginx.error",
            "nginx"
          ],
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ]
        }
      }
    }
  }
}
